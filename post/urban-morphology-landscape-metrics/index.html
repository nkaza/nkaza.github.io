<!DOCTYPE html><html lang="en-us" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.4.0 for Hugo" />
  

  
  









  




  
  

  
  
  

  
    <meta name="google-site-verification" content="qq9qzDEmo2CWQJ-GjKaptUQs7Odqb9aHsm4k_yFaVAQ" />
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Nikhil Kaza" />

  
  
  
    
  
  <meta name="description" content="Creating urban landscape metrics" />

  
  <link rel="alternate" hreflang="en-us" href="https://nkaza.github.io/post/urban-morphology-landscape-metrics/" />

  
  
  
    <meta name="theme-color" content="#1565c0" />
  

  
  
    
    <script src="/js/mathjax-config.js"></script>
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.f1ecf783c14edc00c9320c205831ad8e.css" media="print" onload="this.media='all'">

  
  
  
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha512-W0xM4mr6dEP9nREo7Z9z+9X70wytKvMGeDsj7ps2+xg5QPrEBXC8tAW1IFnzjR6eoJ90JmCnFzerQJTLzIEHjA==" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    
    
    
    
      
      
    
    
    

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/styles/github.min.css" crossorigin="anonymous" title="hl-light" media="print" onload="this.media='all'">
          <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" media="print" onload="this.media='all'" disabled>
        
      
    

    
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.css" integrity="" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.0d287f18ae9831e05717a040ad587d40.css" />

  




<script async src="https://www.googletagmanager.com/gtag/js?id=UA-121426944-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
      dataLayer.push(arguments);
  }

  function trackOutboundLink(url, target) {
    gtag('event', 'click', {
         'event_category': 'outbound',
         'event_label': url,
         'transport_type': 'beacon',
         'event_callback': function () {
           if (target !== '_blank') {
             document.location = url;
           }
         }
    });
    console.debug("Outbound link clicked: " + url);
  }

  function onClickCallback(event) {
    if ((event.target.tagName !== 'A') || (event.target.host === window.location.host)) {
      return;
    }
    trackOutboundLink(event.target, event.target.getAttribute('target'));  
  }

  gtag('js', new Date());
  gtag('config', 'UA-121426944-1', { 'anonymize_ip': true });
  gtag('set', {'cookie_flags': 'SameSite=None;Secure'});

  
  document.addEventListener('click', onClickCallback, false);
</script>


  

  

  




  
  
  

  

  
    <link rel="manifest" href="/manifest.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hu1ca6a6912ef6c300619228a995d3f134_46128_32x32_fill_lanczos_center_3.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hu1ca6a6912ef6c300619228a995d3f134_46128_180x180_fill_lanczos_center_3.png" />

  <link rel="canonical" href="https://nkaza.github.io/post/urban-morphology-landscape-metrics/" />

  
  
  
  
  
  
  
  
    
  
  

  
  
    
    
  
  <meta property="twitter:card" content="summary_large_image" />
  
  <meta property="og:site_name" content="Nikhil Kaza" />
  <meta property="og:url" content="https://nkaza.github.io/post/urban-morphology-landscape-metrics/" />
  <meta property="og:title" content="Urban Morphology &amp; Landscape Metrics | Nikhil Kaza" />
  <meta property="og:description" content="Creating urban landscape metrics" /><meta property="og:image" content="https://nkaza.github.io/post/urban-morphology-landscape-metrics/featured.jpg" />
    <meta property="twitter:image" content="https://nkaza.github.io/post/urban-morphology-landscape-metrics/featured.jpg" /><meta property="og:locale" content="en-us" />
  
    
      <meta
        property="article:published_time"
        content="2020-03-12T00:00:00&#43;00:00"
      />
    
    <meta property="article:modified_time" content="2020-03-12T00:00:00&#43;00:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://nkaza.github.io/post/urban-morphology-landscape-metrics/"
  },
  "headline": "Urban Morphology \u0026 Landscape Metrics",
  
  "image": [
    "https://nkaza.github.io/post/urban-morphology-landscape-metrics/featured.jpg"
  ],
  
  "datePublished": "2020-03-12T00:00:00Z",
  "dateModified": "2020-03-12T00:00:00Z",
  
  "author": {
    "@type": "Person",
    "name": "Nikhil Kaza"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "Nikhil Kaza",
    "logo": {
      "@type": "ImageObject",
      "url": "https://nkaza.github.io/media/icon_hu1ca6a6912ef6c300619228a995d3f134_46128_192x192_fill_lanczos_center_3.png"
    }
  },
  "description": "Creating urban landscape metrics"
}
</script>

  

  

  
  
  
  
  
    <script src="https://cdn.jsdelivr.net/gh/osano/cookieconsent@3.1.1/build/cookieconsent.min.js" integrity="sha512-yXXqOFjdjHNH1GND+1EO0jbvvebABpzGKD66djnUfiKlYME5HGMUJHoCaeE4D5PTG2YsSJf6dwqyUUvQvS0vaA==" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/osano/cookieconsent@3.1.1/build/cookieconsent.min.css" integrity="sha512-LQ97camar/lOliT/MqjcQs5kWgy6Qz/cCRzzRzUCfv0fotsCTC9ZHXaPQmJV8Xu/PVALfJZ7BDezl5lW3/qBxg==" crossorigin="anonymous">
  
  <script>
  window.addEventListener("load", function(){
    window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "#1565c0",
          "text": "rgb(255, 255, 255)"
        },
        "button": {
          "background": "rgb(255, 255, 255)",
          "text": "#1565c0"
        }
      },
      "theme": "classic",
      "content": {
        "message": "Third party cookies are used on this website. You can disable them on your browser's privacy settings without losing any functionality.",
        "dismiss": "Got it!",
        "link": "Learn more",
        "href": "/privacy/"
      }
    })});
  </script>


  





  <title>Urban Morphology &amp; Landscape Metrics | Nikhil Kaza</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="41f4150c5a3b810299fad4fb588433be" >

  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.8f76bdc9e086322ed5147724ebba3d06.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="Close"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="Search...">
        
      </div>

      
      

      

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header">
    












<header class="header--fixed">
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/">Nikhil Kaza</a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Toggle navigation">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/">Nikhil Kaza</a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-end" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#about"><span>Home</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#posts"><span>Posts</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#featured"><span>Publications</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#projects"><span>Projects</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#teaching"><span>Teaching</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/files/pdfs/cv.pdf"><span>CV</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#contact"><span>Contact</span></a>
          </li>

          
          

          

          
          
          
            
              
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="https://cse.google.com/cse?cx=003304552390625136873:si-f1ne2ahe" target="_blank" rel="noopener"><span>Search</span></a>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        
          
        

        
        

        
        
        <li class="nav-item dropdown theme-dropdown">
          <a href="#" class="nav-link" data-toggle="dropdown" aria-haspopup="true" aria-label="Display preferences">
            <i class="fas fa-moon" aria-hidden="true"></i>
          </a>
          <div class="dropdown-menu">
            <a href="#" class="dropdown-item js-set-theme-light">
              <span>Light</span>
            </a>
            <a href="#" class="dropdown-item js-set-theme-dark">
              <span>Dark</span>
            </a>
            <a href="#" class="dropdown-item js-set-theme-auto">
              <span>Automatic</span>
            </a>
          </div>
        </li>
        

        
        

      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    <article class="article">
  





















  
  


<div class="article-container pt-3">
  <h1>Urban Morphology &amp; Landscape Metrics</h1>

  

  


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    Mar 12, 2020
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    16 min read
  </span>
  

  
  
  
  
  
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/category/r/">R</a>, <a href="/category/teaching/">teaching</a></span>
  

</div>

  




<div class="btn-links mb-3">
  
  








  









  
  <a class="btn btn-outline-primary btn-page-header" href="/project/urban-change/">
    Project
  </a>
  











</div>


</div>


<div class="article-header article-container featured-image-wrapper mt-4 mb-4" style="max-width: 708px; max-height: 312px;">
  <div style="position: relative">
    <img src="/post/urban-morphology-landscape-metrics/featured_hu3a75e73a8da3e347a8913b25156cca2d_74626_720x2500_fit_q75_h2_lanczos.webp" width="708" height="312" alt="" class="featured-image">
    
  </div>
</div>


  <div class="article-container">
    <div class="row">
      <div class="col-12 col-lg-9 article-style">
        
<script src="https://nkaza.github.io/post/urban-morphology-landscape-metrics/index_files/kePrint/kePrint.js"></script>
<link href="https://nkaza.github.io/post/urban-morphology-landscape-metrics/index_files/lightable/lightable.css" rel="stylesheet" />
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>


<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>In this post, I am going to show how to characterise urban form using urban landscape metrics.
Landscape metrics are relatively common on ecology to understand the configuration and composition of natural landscapes. Their application to urban landscape is relatively novel, though is becoming more widespread.</p>
<p>Most of the methods and results are discussed in <a href="/publication/kaza_changing_2013/">Kaza (2013)</a> and <a href="/publication/kazawpyo/">McCarty &amp; Kaza (2015)</a>. Please refer to those articles.</p>
</div>
<div id="requirements" class="section level2">
<h2>Requirements</h2>
<p>This requires <a href="http://r-project.org">R</a>, the many libraries including <a href="https://cran.r-project.org/web/packages/raster/">raster</a>, <a href="https://cran.r-project.org/web/packages/raster/">terra</a>, <a href="https://cran.r-project.org/package=mmand">mmand</a> and <a href="https://cran.r-project.org/web/packages/landscapemetrics/index.html">landscapemetrics</a>.</p>
<p>I strongly recommend that you read through <a href="http://rspatial.org/index.html">R spatial</a> by <a href="https://desp.ucdavis.edu/people/robert-j-hijmans">Robert Hijmans</a>, the author of the <code>raster</code> and <code>terra</code> packages. <code>terra</code> is a newer implementation of <code>raster</code>. Usually it is faster, but it does not have all the functionality of <code>raster</code>. So I am going to switch between the two as necessary.</p>
</div>
<div id="acquire-data" class="section level2">
<h2>Acquire data</h2>
<p>I am going to use a <a href="https://www.dropbox.com/s/pbx180gw420g03l/Archive.zip?dl=0">small section</a> of the <a href="https://www.mrlc.gov/nlcd11_data.php">US National Land Cover Dataset for 2011</a> from United States Geological Survey. You are welcome to use any categorical raster data. If you are interested in automatically downloading the data with the script try <code>FedData</code> package from github.</p>
</div>
<div id="explore-the-data" class="section level2">
<h2>Explore the data</h2>
<p><code>raster::raster</code> creates a raster object, while <code>terra::rast</code> creates as SpatRaster object. Both packages have <code>writeRaster</code> function, but I strongly recommend using the <code>terra</code> implementation, by using <code>terra::writeRaster</code>. In fact, it is a good idea to append the package name when dealing with rasters, especially since <code>select</code> in rasters conflict with <code>select</code> in <code>dplyr</code>. Jakub Nowosad’s <a href="https://geocompr.github.io/post/2021/spatial-classes-conversion/">blog</a> explains how to convert between various classes of objects.</p>
<p>It is also useful to learn about the differences between rasterLayers, rasterStack and rasterBrick, if you are using <code>raster</code> package. <code>terra</code> on the other hand, only has a single class <code>spatRaster</code> and you can append layers using the traditional <code>c</code> function.</p>
<p>Initialise the packages and read them into R along with the raster.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rasterVis)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>lc <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;tutorials_datasets&quot;</span>, <span class="st">&quot;lmetrics&quot;</span>, <span class="st">&quot;c11_37063.img&quot;</span>) <span class="sc">%&gt;%</span>   raster<span class="sc">::</span><span class="fu">raster</span>() <span class="sc">%&gt;%</span> raster<span class="sc">::</span><span class="fu">ratify</span>()</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>nlcd_class <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">&quot;tutorials_datasets&quot;</span>, <span class="st">&quot;lmetrics&quot;</span>, <span class="st">&quot;legend_csv.csv&quot;</span>) , <span class="at">col_types =</span> <span class="st">&#39;iccc_&#39;</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>rat <span class="ot">&lt;-</span> <span class="fu">levels</span>(lc)[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span> <span class="fu">merge</span>(nlcd_class, <span class="at">by.x=</span><span class="st">&quot;ID&quot;</span>, <span class="at">by.y=</span><span class="st">&quot;Value&quot;</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(lc) <span class="ot">&lt;-</span> rat</span></code></pre></div>
<p>The land cover is assigned to the object <code>lc</code>. I prepared it so that it is a categorical raster with the right colors in the colortable. See attributes below.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>lc</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># class      : RasterLayer </span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># dimensions : 1483, 892, 1322836  (nrow, ncol, ncell)</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># resolution : 30, 30  (x, y)</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># extent     : 1510215, 1536975, 1558875, 1603365  (xmin, xmax, ymin, ymax)</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># crs        : +proj=aea +lat_0=23 +lon_0=-96 +lat_1=29.5 +lat_2=45.5 +x_0=0 +y_0=0 +ellps=GRS80 +units=m +no_defs </span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># source     : c11_37063.img </span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># names      : Layer_1 </span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># values     : 11, 95  (min, max)</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># attributes :</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">#        ID    Class               Classification colortable</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">#  from: 11    Water                   Open Water    #5475A8</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   to : 95 Wetlands Emergent Herbaceous Wetlands    #64B3D5</span></span></code></pre></div>
<p>Here is the frequency table of counts of cells in various categories and visualisation of the raster.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">freq</span>(lc)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#       value  count</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  [1,]    11  25218</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#  [2,]    21 170495</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#  [3,]    22  74482</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">#  [4,]    23  42961</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">#  [5,]    24  10213</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">#  [6,]    31   1214</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">#  [7,]    41 222663</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co">#  [8,]    42 109305</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">#  [9,]    43  30740</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># [10,]    52  16259</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># [11,]    71  37211</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co"># [12,]    81  68416</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># [13,]    82   4926</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co"># [14,]    90  41920</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co"># [15,]    95   1180</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co"># [16,]    NA 465633</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>rasterVis<span class="sc">::</span><span class="fu">levelplot</span>(lc, <span class="at">att=</span><span class="st">&quot;Classification&quot;</span>, <span class="at">ylab=</span><span class="cn">NULL</span>, <span class="at">xlab=</span><span class="cn">NULL</span>, <span class="at">scales=</span><span class="fu">list</span>(<span class="at">y=</span><span class="fu">list</span>(<span class="at">draw=</span><span class="cn">FALSE</span>), <span class="at">x=</span><span class="fu">list</span>(<span class="at">draw=</span><span class="cn">FALSE</span>)),  <span class="at">col.regions=</span><span class="fu">levels</span>(lc)[[<span class="dv">1</span>]]<span class="sc">$</span>colortable, <span class="at">main=</span><span class="st">&quot;2011 Land Cover&quot;</span>)</span></code></pre></div>
<p><img src="https://nkaza.github.io/post/urban-morphology-landscape-metrics/index_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
</div>
<div id="analyse-the-raster" class="section level2">
<h2>Analyse the raster</h2>
<p>Select the categories that are urban, These are Values <code>21,22,23,24</code> and set them to 1. Set the rest to 0. Another alternative is <code>reclassify</code> function from the <code>raster</code> package to achieve the same output</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>urb_lc <span class="ot">&lt;-</span> <span class="fu">calc</span>(lc, <span class="at">fun =</span> <span class="cf">function</span>(x){<span class="fu">ifelse</span>(x<span class="sc">&gt;=</span><span class="dv">21</span> <span class="sc">&amp;</span> x<span class="sc">&lt;=</span><span class="dv">24</span>, <span class="dv">1</span>, <span class="dv">0</span>)})<span class="sc">%&gt;%</span> ratify</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">freq</span>(urb_lc)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">#      value  count</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># [1,]     0 559052</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># [2,]     1 298151</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># [3,]    NA 465633</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> <span class="fu">levelplot</span>(urb_lc, <span class="at">att=</span><span class="st">&quot;ID&quot;</span>, <span class="at">ylab=</span><span class="cn">NULL</span>, <span class="at">xlab=</span><span class="cn">NULL</span>, <span class="at">main =</span> <span class="st">&quot;Urban Land Cover&quot;</span>, <span class="at">colorkey=</span><span class="cn">FALSE</span>, <span class="at">scales=</span><span class="fu">list</span>(<span class="at">y=</span><span class="fu">list</span>(<span class="at">draw=</span><span class="cn">FALSE</span>), <span class="at">x=</span><span class="fu">list</span>(<span class="at">draw=</span><span class="cn">FALSE</span>))))</span></code></pre></div>
<p><img src="https://nkaza.github.io/post/urban-morphology-landscape-metrics/index_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Here is an approach using <code>terra</code></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>lc_terra <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(lc)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>urb_lc_terra <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">ifel</span>(lc_terra<span class="sc">&gt;=</span><span class="dv">21</span> <span class="sc">&amp;</span> lc_terra<span class="sc">&lt;=</span><span class="dv">24</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(urb_lc_terra)</span></code></pre></div>
<p><img src="https://nkaza.github.io/post/urban-morphology-landscape-metrics/index_files/figure-html/unnamed-chunk-5-1.png" width="672" />
Often it becomes necessary to remove temporary files that <code>terra</code> has written to the disk because you are running out of space. Using the following function, usually solves the problem.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tmpFiles</span>(<span class="at">remove =</span> F)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># character(0)</span></span></code></pre></div>
<p><div class="alert alert-note">
  <div>
    </p>
<p>Otherwise explicitly, specify file.names in each terra functions and manually delete them when you don’t need them. This is a better option.</p>
<p>
  </div>
</div>
</p>
<p>Now construct the urban patches from the urban raster. For this you need <code>landscapemetrics</code> library.
The requirements to calculate meaningful landscape metrics are:
- The distance units of your projection are meter, as the package converts units internally and returns results in either meters, square meters or hectares. For more information see the help file of each function.
- The raster is categorical and the classes are integers (0,1….n)</p>
<p>A naive urban landscape metrics are ready to be calculated from the binary image after checking for the landscape.</p>
<p>For the sake of brevity, I am only checking the area metrics. I am going to ignore patches of class 0 (background).</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;r-spatialecology/landscapemetrics&quot;</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(landscapemetrics)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(skimr)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">options_landscapemetrics</span>(<span class="at">to_disk =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">check_landscape</span>(urb_lc_terra)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   layer       crs units   class n_classes OK</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 1     1 projected     m integer         2  ✔</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>naivemetrics1 <span class="ot">&lt;-</span> <span class="fu">calculate_lsm</span>(<span class="fu">as.factor</span>(urb_lc_terra), <span class="at">what =</span> <span class="st">&quot;lsm_p_area&quot;</span>)  </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>naivemetrics1  <span class="sc">%&gt;%</span> <span class="fu">filter</span>(class<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(value))</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co"># # A tibble: 400 × 6</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co">#    layer level class    id metric   value</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co">#    &lt;int&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt;</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co">#  1     1 patch     1   728 area   25261. </span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co">#  2     1 patch     1   865 area     506. </span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co">#  3     1 patch     1  1077 area     163. </span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co">#  4     1 patch     1   956 area     106. </span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co">#  5     1 patch     1   736 area      36.4</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="co">#  6     1 patch     1  1119 area      22.3</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="co">#  7     1 patch     1  1066 area      18.4</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="co">#  8     1 patch     1   936 area      18.3</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="co">#  9     1 patch     1   993 area      17.7</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 10     1 patch     1   746 area      16.1</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="co"># # … with 390 more rows</span></span></code></pre></div>
<p><div class="alert alert-alert">
  <div>
    </p>
<p>There is a bug in the patch labels in landscapemetrics package before version 1.5.5. If you are getting wrong resutls, please check to make sure that you have the most up to date version from github.</p>
<p>
  </div>
</div>
</p>
<p>The area of the cells in one of the patches is substantially larger than the next largest patch. This means most of urban area in this raster is connected and forms a single patch, even though visually we can see distinct neighbourhoods. Most of these urban areas are connected through roads. These roads should not technically should not count towards urban area characteristics. To do this problem, we will have to use a <a href="%22./datasets/Highways.zip%22">Highways vector file</a> an remove them from the raster. To read the vector file and to do some vector operations, we need <code>rgdal</code>, <code>sp</code> and <code>rgeos</code> libraries. Load them and modify the path suitably to read the Highway file.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>highways <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;tutorials_datasets&quot;</span>, <span class="st">&quot;lmetrics&quot;</span>, <span class="st">&quot;Highways.shp&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>              <span class="fu">read_sf</span>()<span class="sc">%&gt;%</span> <span class="fu">st_transform</span>(<span class="fu">crs</span>(urb_lc_terra))</span></code></pre></div>
<p>The highways and the lc objects have different projections and coordinate systems. We need to align them if we can do any operations. Visualise them by styling the width of the line using <code>lwd</code> parameter. Note that <code>Width</code> attribute is a factor and therefore numerical operations are not permitted. We need to convert it to numerical value before styling the lines.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> latticeExtra<span class="sc">::</span><span class="fu">layer</span>(<span class="fu">sp.lines</span>(highways <span class="sc">%&gt;%</span> <span class="fu">as</span>(<span class="st">&quot;Spatial&quot;</span>), <span class="at">lwd=</span><span class="fu">as.numeric</span>(highways<span class="sc">$</span>Width)<span class="sc">/</span><span class="dv">24</span>, <span class="at">col=</span><span class="st">&#39;red&#39;</span>))</span></code></pre></div>
<p><img src="https://nkaza.github.io/post/urban-morphology-landscape-metrics/index_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>Buffer the highways with a specified width.I am using the NCDOT guidelines that 4 lane highways have 150-300ft of Right of Way. So assuming 65 ft per lane (20m), we get</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>highways <span class="ot">&lt;-</span> highways <span class="sc">%&gt;%</span> </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>           <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(LANES)) <span class="sc">%&gt;%</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>           <span class="fu">mutate</span>(<span class="at">width_m =</span> <span class="fu">as.numeric</span>(LANES) <span class="sc">*</span> <span class="dv">20</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>highways_buffer <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(highways, <span class="at">dist=</span>highways<span class="sc">$</span>width_m)</span></code></pre></div>
<p>Now extract the cell numbers that overlap with the buffer and set those values to 0.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">extract</span>(urb_lc_terra, <span class="fu">vect</span>(highways_buffer), <span class="at">cells=</span><span class="cn">TRUE</span>, <span class="at">touches=</span>T)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>urb_lc2 <span class="ot">&lt;-</span> urb_lc_terra</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>urb_lc2[v<span class="sc">$</span>cell] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">levelplot</span>(urb_lc2, <span class="at">ylab=</span><span class="cn">NULL</span>, <span class="at">xlab=</span><span class="cn">NULL</span>, <span class="at">main=</span><span class="st">&quot;Urban (Highways Removed)&quot;</span>, <span class="at">colorkey=</span><span class="cn">FALSE</span>, <span class="at">margin =</span> <span class="cn">FALSE</span>, <span class="at">scales=</span><span class="fu">list</span>(<span class="at">y=</span><span class="fu">list</span>(<span class="at">draw=</span><span class="cn">FALSE</span>), <span class="at">x=</span><span class="fu">list</span>(<span class="at">draw=</span><span class="cn">FALSE</span>)))</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p, <span class="at">split=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="at">more=</span><span class="cn">TRUE</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p2, <span class="at">split=</span><span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><img src="https://nkaza.github.io/post/urban-morphology-landscape-metrics/index_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>metrics2 <span class="ot">&lt;-</span> <span class="fu">calculate_lsm</span>(urb_lc2, <span class="at">what =</span> <span class="st">&quot;lsm_p_area&quot;</span>) </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>metrics2  <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(value))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># # A tibble: 2,471 × 6</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">#    layer level class    id metric  value</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">#    &lt;int&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt;</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co">#  1     1 patch     0     1 area   59735.</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co">#  2     1 patch     1   930 area    1018.</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co">#  3     1 patch     1  1150 area     779.</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co">#  4     1 patch     1   780 area     454.</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co">#  5     1 patch     1   844 area     452.</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co">#  6     1 patch     1  1394 area     349.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co">#  7     1 patch     1  1088 area     322.</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co">#  8     1 patch     1  1377 area     305.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co">#  9     1 patch     1   920 area     280.</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 10     1 patch     1  1283 area     277.</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="co"># # … with 2,461 more rows</span></span></code></pre></div>
<p>The before picture is on the left and the after is on the right. We can now see some improvement, but it is not great. This because the vectorfiles are not perfectly aligned with the raster files and therefore any overlay operations leave a significant number of small <em>error</em> patches.To deal with this we need to turn to morphological operations borrowed from Image Processing literature.</p>
<hr />
<p><strong>Exercise</strong></p>
<ul>
<li>Repeat the exercise with highways object as “sp” and raster objects. See the performance differential.</li>
</ul>
<hr />
</div>
<div id="a-digression-into-morphological-operations" class="section level2">
<h2>A digression into morphological operations</h2>
<p>There are four basic operations. I will go through them one by one. But first we need to convert the raster into a matrix that the library <code>mmand</code> can process.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(mmand)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>urb_mat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(urb_lc2)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>urb_lc3 <span class="ot">&lt;-</span> urb_lc2</span></code></pre></div>
<div id="structuring-elements" class="section level3">
<h3>Structuring elements</h3>
<p>Morphological operations require something called a structuring element that probes the image.
<img src="img/morph-probing.jpg" style="width:100.0%;height:100.0%" alt="Borrowed from https://www.cs.auckland.ac.nz/courses/compsci773s1c/lectures/ImageProcessing-html/topic4.htm" /></p>
<p>Structuring elements can be of any dimension But usually they are of odd because it is easier to locate the center. For this exercise, I am using a structuring element of a 3x3 matrix of 1s. If you want a fancy structuring element like a cross, create a binary image with 0s and 1s such as k2 below.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>(k <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span>,<span class="at">nrow=</span><span class="dv">3</span>,<span class="at">ncol=</span><span class="dv">3</span>))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">#      [,1] [,2] [,3]</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># [1,]    1    1    1</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># [2,]    1    1    1</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># [3,]    1    1    1</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>k2 <span class="ot">&lt;-</span> k</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>k2[<span class="dv">1</span>,<span class="dv">1</span>] <span class="ot">&lt;-</span> k2[<span class="dv">1</span>,<span class="dv">3</span>] <span class="ot">&lt;-</span> k2[<span class="dv">3</span>,<span class="dv">1</span>] <span class="ot">&lt;-</span> k2[<span class="dv">3</span>,<span class="dv">3</span>]<span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>k2</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co">#      [,1] [,2] [,3]</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co"># [1,]    0    1    0</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co"># [2,]    1    1    1</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co"># [3,]    0    1    0</span></span></code></pre></div>
</div>
<div id="erosion" class="section level3">
<h3>Erosion</h3>
<p>The erosion of a binary image <span class="math inline">\(A\)</span> by a structuring element <span class="math inline">\(S\)</span> (denoted <span class="math inline">\(A \ominus S\)</span>) produces a new binary image <span class="math inline">\(B\)</span> of the dimensions of <span class="math inline">\(A\)</span>, with 1s in the locations, where the structuring element <span class="math inline">\(S\)</span> ‘fits’ <span class="math inline">\(A\)</span>. i.e. If the center of <span class="math inline">\(S\)</span> is placed on <span class="math inline">\((x,y)\)</span> of <span class="math inline">\(A\)</span> and if 1s of the structuring element also correspond to the 1s of <span class="math inline">\(A\)</span>, then <span class="math inline">\((x,y)\)</span> of B is rendered 1 otherwise 0. See the effect of erosion on the image below</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>urb_mat2 <span class="ot">&lt;-</span> <span class="fu">erode</span>(urb_mat, k)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>urb_mat2[<span class="sc">!</span><span class="fu">is.finite</span>(urb_mat2)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>urb_lc3[] <span class="ot">&lt;-</span> urb_mat2</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>urb_lc3 <span class="ot">&lt;-</span> urb_lc3 </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">levelplot</span>(urb_lc3, <span class="at">ylab=</span><span class="cn">NULL</span>, <span class="at">xlab=</span><span class="cn">NULL</span>, <span class="at">main =</span> <span class="st">&quot;Erosion (k)&quot;</span>, <span class="at">colorkey=</span><span class="cn">FALSE</span>, <span class="at">margin =</span> <span class="cn">FALSE</span>, <span class="at">scales=</span><span class="fu">list</span>(<span class="at">y=</span><span class="fu">list</span>(<span class="at">draw=</span><span class="cn">FALSE</span>), <span class="at">x=</span><span class="fu">list</span>(<span class="at">draw=</span><span class="cn">FALSE</span>)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p2, <span class="at">split=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="at">more=</span><span class="cn">TRUE</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p3, <span class="at">split=</span><span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><img src="https://nkaza.github.io/post/urban-morphology-landscape-metrics/index_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
</div>
<div id="dilation" class="section level3">
<h3>Dilation</h3>
<p>The dilation of a binary image <span class="math inline">\(A\)</span> by a structuring element <span class="math inline">\(S\)</span> (denoted <span class="math inline">\(A \oplus S\)</span>) produces a new binary image <span class="math inline">\(B\)</span> of the dimensions of <span class="math inline">\(A\)</span>, with 1s in the locations, where the structuring element <span class="math inline">\(S\)</span> ‘hits’ <span class="math inline">\(A\)</span>. i.e. If the center of <span class="math inline">\(S\)</span> is placed on <span class="math inline">\((x,y)\)</span> of <span class="math inline">\(A\)</span> and if 1s of the structuring element also correspond at least some of the 1s of <span class="math inline">\(A\)</span>, then <span class="math inline">\((x,y)\)</span> of B is rendered 1 otherwise 0. Dilation has the opposite effect to erosion – it adds a layer of pixels to both the inner and outer boundaries of regions. See the effect of dilation on the original image below.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>urb_mat2 <span class="ot">&lt;-</span> <span class="fu">dilate</span>(urb_mat, k)</span></code></pre></div>
<p><img src="https://nkaza.github.io/post/urban-morphology-landscape-metrics/index_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
</div>
<div id="closing" class="section level3">
<h3>Closing</h3>
<p>Closing is simply dilation followed by erosion: <span class="math inline">\(A \bullet S = (A \oplus S) \ominus S\)</span>. Closing is so called because it can fill holes in the regions while keeping the initial region sizes. You can see the effect of closing compared to the original image below.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>urb_mat2 <span class="ot">&lt;-</span> <span class="fu">closing</span>(urb_mat, k)</span></code></pre></div>
<p><img src="https://nkaza.github.io/post/urban-morphology-landscape-metrics/index_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
</div>
<div id="opening" class="section level3">
<h3>Opening</h3>
<p>Opening is simply erosion followed by dilation: <span class="math inline">\(A \circ S = (A \ominus S) \oplus S\)</span>. Opening is so called because it can open up a gap between objects connected by a thin bridge of pixels. Any regions that have survived the erosion are restored to their original size by the dilation. You can see the effect of opening compared to the original image below</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>urb_mat2 <span class="ot">&lt;-</span> <span class="fu">opening</span>(urb_mat, k)</span></code></pre></div>
<p><img src="https://nkaza.github.io/post/urban-morphology-landscape-metrics/index_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>From the above experiments, it should be obvious that opening gives us the best option for urban landscape metrics. Experiment with other structuring elements.</p>
<p><img src="https://nkaza.github.io/post/urban-morphology-landscape-metrics/index_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
</div>
</div>
<div id="landscape-metrics" class="section level2">
<h2>Landscape metrics</h2>
<p>Now we are ready to create some metrics. Let’s create some metrics for each patch. Some of the key metrics are <code>area</code> (area of the patch) and <code>core areaindex</code> (area after eliminating edges). You can use these to further threshold the patches that might be too small to matter.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_landscape</span>(urb_lc3)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   layer       crs units   class n_classes OK</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 1     1 projected     m integer         2  ✔</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>ps.data <span class="ot">&lt;-</span> <span class="fu">calculate_lsm</span>(urb_lc3, <span class="at">level =</span> <span class="st">&quot;patch&quot;</span>)  <span class="sc">%&gt;%</span> <span class="fu">filter</span>(class<span class="sc">==</span><span class="dv">1</span> )</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>ps.data  <span class="sc">%&gt;%</span> </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> metric, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">skim</span>()</span></code></pre></div>
<table style="width: auto;" class="table table-condensed">
<caption>
<span id="tab:unnamed-chunk-22">Table 1: </span>Data summary
</caption>
<tbody>
<tr>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
Piped data
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of rows
</td>
<td style="text-align:left;">
1194
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of columns
</td>
<td style="text-align:left;">
16
</td>
</tr>
<tr>
<td style="text-align:left;">
_______________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Column type frequency:
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
character
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
15
</td>
</tr>
<tr>
<td style="text-align:left;">
________________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Group variables
</td>
<td style="text-align:left;">
None
</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
min
</th>
<th style="text-align:right;">
max
</th>
<th style="text-align:right;">
empty
</th>
<th style="text-align:right;">
n_unique
</th>
<th style="text-align:right;">
whitespace
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
level
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
p0
</th>
<th style="text-align:right;">
p25
</th>
<th style="text-align:right;">
p50
</th>
<th style="text-align:right;">
p75
</th>
<th style="text-align:right;">
p100
</th>
<th style="text-align:left;">
hist
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
layer
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:left;">
▁▁▇▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
class
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:left;">
▁▁▇▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
id
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
754.50
</td>
<td style="text-align:right;">
344.82
</td>
<td style="text-align:right;">
158.00
</td>
<td style="text-align:right;">
456.25
</td>
<td style="text-align:right;">
754.50
</td>
<td style="text-align:right;">
1052.75
</td>
<td style="text-align:right;">
1351.00
</td>
<td style="text-align:left;">
▇▇▇▇▇
</td>
</tr>
<tr>
<td style="text-align:left;">
area
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
13.58
</td>
<td style="text-align:right;">
52.31
</td>
<td style="text-align:right;">
0.09
</td>
<td style="text-align:right;">
0.36
</td>
<td style="text-align:right;">
1.08
</td>
<td style="text-align:right;">
4.93
</td>
<td style="text-align:right;">
984.60
</td>
<td style="text-align:left;">
▇▁▁▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
cai
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
24.30
</td>
<td style="text-align:right;">
28.92
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
10.00
</td>
<td style="text-align:right;">
48.80
</td>
<td style="text-align:right;">
91.12
</td>
<td style="text-align:left;">
▇▂▂▂▁
</td>
</tr>
<tr>
<td style="text-align:left;">
circle
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.61
</td>
<td style="text-align:right;">
0.12
</td>
<td style="text-align:right;">
0.27
</td>
<td style="text-align:right;">
0.53
</td>
<td style="text-align:right;">
0.62
</td>
<td style="text-align:right;">
0.69
</td>
<td style="text-align:right;">
0.93
</td>
<td style="text-align:left;">
▁▃▇▅▁
</td>
</tr>
<tr>
<td style="text-align:left;">
contig
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.54
</td>
<td style="text-align:right;">
0.26
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.25
</td>
<td style="text-align:right;">
0.56
</td>
<td style="text-align:right;">
0.79
</td>
<td style="text-align:right;">
0.97
</td>
<td style="text-align:left;">
▁▇▃▅▆
</td>
</tr>
<tr>
<td style="text-align:left;">
core
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
10.38
</td>
<td style="text-align:right;">
44.52
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.09
</td>
<td style="text-align:right;">
2.34
</td>
<td style="text-align:right;">
825.66
</td>
<td style="text-align:left;">
▇▁▁▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
enn
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
156.90
</td>
<td style="text-align:right;">
166.39
</td>
<td style="text-align:right;">
60.00
</td>
<td style="text-align:right;">
67.08
</td>
<td style="text-align:right;">
120.00
</td>
<td style="text-align:right;">
152.97
</td>
<td style="text-align:right;">
1615.55
</td>
<td style="text-align:left;">
▇▁▁▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
frac
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.06
</td>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
1.04
</td>
<td style="text-align:right;">
1.05
</td>
<td style="text-align:right;">
1.07
</td>
<td style="text-align:right;">
1.22
</td>
<td style="text-align:left;">
▇▆▂▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
gyrate
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
97.64
</td>
<td style="text-align:right;">
142.60
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
27.36
</td>
<td style="text-align:right;">
45.17
</td>
<td style="text-align:right;">
98.52
</td>
<td style="text-align:right;">
1577.77
</td>
<td style="text-align:left;">
▇▁▁▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
ncore
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.58
</td>
<td style="text-align:right;">
0.66
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
5.00
</td>
<td style="text-align:left;">
▇▁▁▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
para
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.03
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.02
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.08
</td>
<td style="text-align:right;">
0.13
</td>
<td style="text-align:left;">
▇▆▃▇▁
</td>
</tr>
<tr>
<td style="text-align:left;">
perim
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1561.21
</td>
<td style="text-align:right;">
3720.00
</td>
<td style="text-align:right;">
120.00
</td>
<td style="text-align:right;">
300.00
</td>
<td style="text-align:right;">
540.00
</td>
<td style="text-align:right;">
1200.00
</td>
<td style="text-align:right;">
74040.00
</td>
<td style="text-align:left;">
▇▁▁▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
shape
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1.39
</td>
<td style="text-align:right;">
0.42
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
1.15
</td>
<td style="text-align:right;">
1.25
</td>
<td style="text-align:right;">
1.43
</td>
<td style="text-align:right;">
5.90
</td>
<td style="text-align:left;">
▇▁▁▁▁
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ps.data)<span class="sc">+</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x=</span>value)) <span class="sc">+</span> </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>metric, <span class="at">scales=</span><span class="st">&quot;free&quot;</span>)</span></code></pre></div>
<p><img src="https://nkaza.github.io/post/urban-morphology-landscape-metrics/index_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>It seems to me there are still some really small patches as evidenced the left skews of the distributions in area, core area index (cai) and right skew in the perim.area.ratio. We can use a combination of thresholds on these indices to remove some ‘error’ patches that might skew our urban indices. I choose, core area index <span class="math inline">\(=\)</span> 0 or area less than $&lt;=$0.5ha arbitrarily based on the histogram. Let’s first calculate the class statistics without the modification and then do it with the modification.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>ignore_patches <span class="ot">&lt;-</span> ps.data  <span class="sc">%&gt;%</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>               <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> metric, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span> </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>               <span class="fu">filter</span>(area<span class="sc">&lt;</span>.<span class="dv">5</span> <span class="sc">|</span> cai<span class="sc">==</span><span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">pull</span>(<span class="st">&#39;id&#39;</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>ignore_raster <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">-</span>(<span class="fu">get_patches</span>(urb_lc3, <span class="at">class=</span><span class="dv">1</span>)<span class="sc">$</span>layer<span class="sc">$</span>class_1 <span class="sc">%in%</span> ignore_patches) <span class="sc">%&gt;%</span> rast</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>urb_lc4 <span class="ot">&lt;-</span> ignore_raster <span class="sc">*</span> urb_lc3</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="fu">levelplot</span>(urb_lc4, <span class="at">ylab=</span><span class="cn">NULL</span>, <span class="at">xlab=</span><span class="cn">NULL</span>, <span class="at">main =</span> <span class="st">&quot;Removed Small Patches&quot;</span>, <span class="at">colorkey=</span><span class="cn">FALSE</span>, <span class="at">margin =</span> <span class="cn">FALSE</span>, <span class="at">scales=</span><span class="fu">list</span>(<span class="at">y=</span><span class="fu">list</span>(<span class="at">draw=</span><span class="cn">FALSE</span>), <span class="at">x=</span><span class="fu">list</span>(<span class="at">draw=</span><span class="cn">FALSE</span>)))</span></code></pre></div>
<p><img src="https://nkaza.github.io/post/urban-morphology-landscape-metrics/index_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>Compare the final metrics with the others along the way. I am going to convert the area to sq.km to make things easier to read.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>urb_df <span class="ot">&lt;-</span> <span class="fu">c</span>(urb_lc_terra, urb_lc2, urb_lc3, urb_lc4) <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">calculate_lsm</span>(<span class="at">level =</span> <span class="st">&#39;landscape&#39;</span>, <span class="at">type =</span> <span class="st">&quot;aggregation metric&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">layer =</span> <span class="fu">recode</span>(layer, <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;Naive&quot;</span>, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;Improv1&quot;</span>, <span class="st">`</span><span class="at">3</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;Improv2&quot;</span>, <span class="st">`</span><span class="at">4</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;Final&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">select</span>(layer, metric, value) <span class="sc">%&gt;%</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> layer, <span class="at">values_from =</span> value)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>            </span></code></pre></div>
<table class="table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
metric
</th>
<th style="text-align:right;">
Naive
</th>
<th style="text-align:right;">
Improv1
</th>
<th style="text-align:right;">
Improv2
</th>
<th style="text-align:right;">
Final
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
ai
</td>
<td style="text-align:right;">
93.4
</td>
<td style="text-align:right;">
95.0
</td>
<td style="text-align:right;">
96.4
</td>
<td style="text-align:right;">
96.8
</td>
</tr>
<tr>
<td style="text-align:left;">
cohesion
</td>
<td style="text-align:right;">
99.8
</td>
<td style="text-align:right;">
99.9
</td>
<td style="text-align:right;">
99.9
</td>
<td style="text-align:right;">
99.9
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
contag
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #D7261E !important;">
36.1
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #D7261E !important;">
48.2
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #D7261E !important;">
52.4
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #D7261E !important;">
53.5
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
division
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #D7261E !important;">
0.8
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #D7261E !important;">
0.4
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #D7261E !important;">
0.4
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #D7261E !important;">
0.4
</td>
</tr>
<tr>
<td style="text-align:left;">
enn_cv
</td>
<td style="text-align:right;">
99.4
</td>
<td style="text-align:right;">
102.5
</td>
<td style="text-align:right;">
103.6
</td>
<td style="text-align:right;">
91.7
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
enn_mn
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #D7261E !important;">
113.2
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #D7261E !important;">
127.9
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #D7261E !important;">
152.6
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #D7261E !important;">
161.4
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
enn_sd
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #D7261E !important;">
112.5
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #D7261E !important;">
131.0
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #D7261E !important;">
158.1
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #D7261E !important;">
148.0
</td>
</tr>
<tr>
<td style="text-align:left;">
iji
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
lsi
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #D7261E !important;">
31.8
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #D7261E !important;">
24.7
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #D7261E !important;">
18.2
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #D7261E !important;">
16.5
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
mesh
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #D7261E !important;">
14822.7
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #D7261E !important;">
46115.4
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #D7261E !important;">
48010.0
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #D7261E !important;">
48414.9
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
np
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #D7261E !important;">
1126.0
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #D7261E !important;">
2471.0
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #D7261E !important;">
1351.0
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #D7261E !important;">
765.0
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
pd
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #D7261E !important;">
1.5
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #D7261E !important;">
3.2
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #D7261E !important;">
1.7
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #D7261E !important;">
1.0
</td>
</tr>
<tr>
<td style="text-align:left;">
pladj
</td>
<td style="text-align:right;">
93.4
</td>
<td style="text-align:right;">
95.0
</td>
<td style="text-align:right;">
96.4
</td>
<td style="text-align:right;">
96.8
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
split
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #D7261E !important;">
5.2
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #D7261E !important;">
1.7
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #D7261E !important;">
1.6
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #D7261E !important;">
1.6
</td>
</tr>
</tbody>
</table>
<p>Note that significant changes are observed in highlighted variables. In particular, number of patches change dramatically.</p>
<hr />
<p><strong>Exercises</strong></p>
<p>There are many more improvements possible to these indices. For example,</p>
<ul>
<li>What happens when you use a different road network to remove the roads from the raster?</li>
<li>Different structuring elements for the morphological operations.</li>
<li>Different thresholds on different patch characteristics to remove erroneous urban patches.</li>
<li>Instead of treating urban as a single category, what are the results when we treat it as 4 different categories?</li>
<li>Perhaps explore more complex landscape metrics by characterising the configuration of urban and non-urban land cover.</li>
</ul>
<hr />
</div>
<div id="conclusions" class="section level2">
<h2>Conclusions</h2>
<p>Landscape metrics have been used in ecology for a long time to understand the fragmentation of landscape from a habitat perspective. However, we can use these metrics to understand the urban pattern as well. In particular, we can study if a place is experiencing at-the-edges-fragmentary urbanisation over time or infill-coalescent urbanisation or edge-exapnsion. These help us understand the urban development patterns over time and if any land use policy changes have made any difference in promoting particular forms of urban growth.</p>
</div>

      </div>
      <div class="col-12 col-lg-3 docs-toc">
        <ul class="nav toc-top">
          <li>
            <a href="#" id="back_to_top" class="docs-toc-title">
              Contents
            </a>
          </li>
        </ul>
        
      </div>
    </div>
    






<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/urban-landscape-metrics/">urban-landscape-metrics</a>
  
</div>



<div class="share-box">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=https://nkaza.github.io/post/urban-morphology-landscape-metrics/&amp;text=Urban%20Morphology%20&amp;amp;%20Landscape%20Metrics" target="_blank" rel="noopener" class="share-btn-twitter" aria-label="twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=https://nkaza.github.io/post/urban-morphology-landscape-metrics/&amp;t=Urban%20Morphology%20&amp;amp;%20Landscape%20Metrics" target="_blank" rel="noopener" class="share-btn-facebook" aria-label="facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Urban%20Morphology%20&amp;amp;%20Landscape%20Metrics&amp;body=https://nkaza.github.io/post/urban-morphology-landscape-metrics/" target="_blank" rel="noopener" class="share-btn-email" aria-label="envelope">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=https://nkaza.github.io/post/urban-morphology-landscape-metrics/&amp;title=Urban%20Morphology%20&amp;amp;%20Landscape%20Metrics" target="_blank" rel="noopener" class="share-btn-linkedin" aria-label="linkedin-in">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="whatsapp://send?text=Urban%20Morphology%20&amp;amp;%20Landscape%20Metrics%20https://nkaza.github.io/post/urban-morphology-landscape-metrics/" target="_blank" rel="noopener" class="share-btn-whatsapp" aria-label="whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=https://nkaza.github.io/post/urban-morphology-landscape-metrics/&amp;title=Urban%20Morphology%20&amp;amp;%20Landscape%20Metrics" target="_blank" rel="noopener" class="share-btn-weibo" aria-label="weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>











  
  



  
  
  
    
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <a href="https://nkaza.github.io/"><img class="avatar mr-3 avatar-circle" src="/author/nikhil-kaza/avatar_hub3f48de923d36a3a7f2a35d484d2e93d_2804906_270x270_fill_q75_lanczos_center.jpg" alt="Nikhil Kaza"></a>
    

    <div class="media-body">
      <h5 class="card-title"><a href="https://nkaza.github.io/">Nikhil Kaza</a></h5>
      <h6 class="card-subtitle">Professor</h6>
      <p class="card-text">My research interests include urbanization patterns, local energy policy and equity</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="/#contact" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://scholar.google.com/citations?user=F0FfN00AAAAJ" target="_blank" rel="noopener">
        <i class="ai ai-google-scholar"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/nkaza" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://orcid.org/0000-0002-9536-7643" target="_blank" rel="noopener">
        <i class="ai ai-orcid"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.linkedin.com/in/nikhilkaza/" target="_blank" rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>
















  
  
  <div class="article-widget content-widget-hr">
    <h3>Related</h3>
    <ul>
      
      <li><a href="/teaching/techniques-course/">Urban Analytics in R</a></li>
      
      <li><a href="/post/geospatial-data-in-r/">Geospatial Data in R</a></li>
      
      <li><a href="/teaching/remote-instruction-672/">Using Rstudio.cloud for Troubleshooting</a></li>
      
    </ul>
  </div>
  




  </div>
</article>
  </div>

  <div class="page-footer">
    
    
    <div class="container">
      <footer class="site-footer">

  



  

  
  <p class="powered-by">
    
      <a href="/privacy/">Privacy Policy</a>
    
    
  </p>
  

  
  <p class="powered-by">
    © 2018-2025 Nikhil Kaza
  </p>
  

  
  





  
  
  
  

  
  
  
    
  

  

  
  <p class="powered-by copyright-license-text">
    Except as otherwise noted, this work is licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0" rel="noopener noreferrer" target="_blank">CC BY SA 4.0</a>, and code samples are licensed under the MIT License.
  </p>
  

  <p class="powered-by footer-license-icons">
    <a href="https://creativecommons.org/licenses/by-sa/4.0" rel="noopener noreferrer" target="_blank" aria-label="Creative Commons">
      <i class="fab fa-creative-commons fa-2x" aria-hidden="true"></i>
      <i class="fab fa-creative-commons-by fa-2x" aria-hidden="true"></i>
      
      
        <i class="fab fa-creative-commons-sa fa-2x" aria-hidden="true"></i>
      
    </a>
  </p>




  <p class="powered-by">
    
    
    
  </p>
</footer>

    </div>
    
  </div>

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

      

    
    <script src="/js/vendor-bundle.min.b73dfaac3b6499dc997741748a7c3fe2.js"></script>

    
    
    
      
      
        <script src="https://cdn.jsdelivr.net/gh/desandro/imagesloaded@v4.1.4/imagesloaded.pkgd.min.js" integrity="sha512-S5PZ9GxJZO16tT9r3WJp/Safn31eu8uWrzglMahDT4dsmgqWonRY9grk3j+3tfuPr9WJNsfooOR7Gi7HL5W2jw==" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/gh/metafizzy/isotope@v3.0.6/dist/isotope.pkgd.min.js" integrity="sha512-Zq2BOxyhvnRFXu0+WE6ojpZLOU2jdnqbrM1hmVdGzyeCa1DgM3X5Q4A/Is9xA1IkbUeDd7755dNNI/PzSf2Pew==" crossorigin="anonymous"></script>
      

      
      

      

      
        
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/highlight.min.js" integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin="anonymous"></script>
        
        
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/languages/r.min.js" crossorigin="anonymous"></script>
        
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/languages/python.min.js" crossorigin="anonymous"></script>
        
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/languages/latex.min.js" crossorigin="anonymous"></script>
        
      

    

    
    
    
      <script src="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.js" integrity="" crossorigin="anonymous"></script>
    

    
    

    
    
    
      
      <script id="search-hit-fuse-template" type="text/x-template">
        <div class="search-hit" id="summary-{{key}}">
          <div class="search-hit-content">
            <div class="search-hit-name">
              <a href="{{relpermalink}}">{{title}}</a>
              <div class="article-metadata search-hit-type">{{type}}</div>
              <p class="search-hit-description">{{snippet}}</p>
            </div>
          </div>
        </div>
      </script>
      
        <script src="https://cdn.jsdelivr.net/gh/krisk/Fuse@v3.2.1/dist/fuse.min.js" integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/gh/julmot/mark.js@8.11.1/dist/jquery.mark.min.js" integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin="anonymous"></script>
      
    

    
    

    
    
    
    

    
    
      
      
      
      
      
      
      
    

    

    
    
    
    <script id="page-data" type="application/json">{"use_headroom":true}</script>

    
    
      <script src="/js/wowchemy-headroom.1cb9e2fc8399acee94eab837265b73bf.js" type="module"></script>
    
    
    
    
    
    
    
      
      
    
    
    <script src="/en/js/wowchemy.min.247fd8f54253895301106e3006f53f38.js"></script>

    
  <script async defer src="https://buttons.github.io/buttons.js"></script>




</body>
</html>
